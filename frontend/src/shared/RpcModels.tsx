// ================================================
// WARNING: This file is automatically generated.
// Do not modify it by hand. Your changes will be
// overwritten the next time the generator runs.
// ================================================

import axios from "axios";

export interface RPCRequest {
  op: string;
  payload: any | null;
  version: number;
  timestamp: string | null;
}
export interface RPCResponse {
  op: string;
  payload: any;
  version: number;
  timestamp: string | null;
}
export interface AuthTokens {
  bearerToken: string;
  session: SessionToken;
}
export interface SessionToken {
  sub: string;
  roles: string[];
  iat: number;
  exp: number;
  jti: string;
  session: string;
  provider: string;
}
export interface PublicVarsFfmpegVersion1 {
  ffmpeg_version: string;
}
export interface PublicVarsHostname1 {
  hostname: string;
}
export interface PublicVarsOdbcVersion1 {
  odbc_version: string;
}
export interface PublicVarsRepo1 {
  repo: string;
}
export interface PublicVarsVersion1 {
  version: string;
}
export interface HomeLinks {
  links: LinkItem[];
}
export interface LinkItem {
  title: string;
  url: string;
}
export interface NavbarRoute {
  path: string;
  label: string;
}
export interface NavbarRoutes {
  routes: NavbarRoute[];
}

export async function rpcCall<T>(op: string, payload: any = null): Promise<T> {
    const request: RPCRequest = {
        op,
        payload,
        version: 1,
        timestamp: new Date().toISOString()
    };
    const headers: Record<string, string> = {};
    if (typeof localStorage !== 'undefined') {
        try {
            const raw = localStorage.getItem('authTokens');
            if (raw) {
                const { bearerToken } = JSON.parse(raw);
                if (bearerToken) headers.Authorization = `Bearer ${bearerToken}`;
            }
        } catch {
            /* ignore token parsing errors */
        }
    }
    const response = await axios.post<RPCResponse>('/rpc', request, { headers });
    return response.data.payload as T;
}
